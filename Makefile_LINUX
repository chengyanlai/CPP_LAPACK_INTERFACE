######### Compilers #############
# CXX := clang -std=c++11 -stdlib=libc++ -Weverything -O3
CXX := icpc -O3 -fast -Wall -std=c++0x #-g #debug flag
CF := gfortran -O3

######## BLAS and LAPACK ########
## For a recent Mac OSX system (include flags intentionally left blank)
# LIBFLAG := OSX
# LIB := -lstdc++ -lblas -llapack -framework Accelerate -lm
## Example using the Intel MKL library
LIBFLAG := MKL
MKLROOT=/home/mmetcalf/intel/mkl/
#LIB := -Wl,--start-group $(MKLROOT)/lib/ia32/libmkl_intel.a $(MKLROOT)/lib/ia32/libmkl_core.a \
#$(MKLROOT)/lib/ia32/libmkl_sequential.a -Wl,--end-group -lpthread -lm
# This is for gfortran, we need -ldl to find dlopen.
LIB := -ldl -Wl,--start-group $(MKLROOT)/lib/ia32/libmkl_intel.a $(MKLROOT)/lib/ia32/libmkl_core.a \
$(MKLROOT)/lib/ia32/libmkl_sequential.a -Wl,--end-group -lpthread -lm


all:f95.e

cpp.e: main.o
	$(CXX) -o $@ $< myLapack.o $(LIB)

main.o: dsyev_example.cpp myLapack.o
	$(CXX) -o $@ -c $<

myLapack.o: myLapack.cpp
	$(CXX) -D${LIBFLAG} -o $@ -c $<

f95.e: main95.o
	$(CF) -o $@ $< myLapack95.o nrtype.o $(LIB)

main95.o: dsyev_example.f90 myLapack95.o nrtype.o
	$(CF) -x f95-cpp-input -o $@ -c $<

myLapack95.o: myLapack95.f90 nrtype.o
	$(CF) -x f95-cpp-input -D${LIBFLAG} -o $@ -c $<

nrtype.o: nrtype.f90
	$(CF) -x f95-cpp-input -o $@ -c $<

clean:
	rm -f *.o *.mod *.e

.PHONY : clean
